
<!DOCTYPE html>
<html lang="ht">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koneksyon</title>
    <a href="#" class="nav-back" onclick="history.back()">‚Üê Tounen</a>
    <link rel="stylesheet" href="Konekte.css">
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h1>Konekte</h1>
            <p>Antre nan kont ou a</p>
        </div>

        <div class="success-message" id="successMessage">
            Koneksyon aksepte! Nou pral redirije w...

        </div>

        <form id="loginForm">
            <div class="form-group">
                <label for="email">Imel oswa Non Itilizat√®</label>
                <input type="text" id="email" name="email" required>
                <div class="error-message" id="emailError">Tanpri antre yon imel ki valab</div>
            </div>

            <div class="form-group">
                <label for="password">Modpas</label>
                <input type="password" id="password" name="password" required>
                <span class="password-toggle" id="passwordToggle">üëÅÔ∏è</span>
                <div class="error-message" id="passwordError">Modpas la dwe gen omwen 6 karakt√®</div>
            </div>

            <div class="remember-me">
                <input type="checkbox" id="rememberMe" name="rememberMe">
                <label for="rememberMe">Sonje mwen</label>
            </div>

            <div class="forgot-password">
                <a href="#" id="forgotPassword">Bliye modpas la?</a>
            </div>

            <button type="submit" class="login-btn" id="loginBtn">
           <button type="submit" class="submit-btn" onclick="redirectToMainPage()">Enskri Kounye a</button>
                <span id="btnText">Konekte</span>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                </div>
            </button>
        </form>

        <div class="divider">
            <span>oswa</span>
        </div>

        <div class="social-login">
            <button class="social-btn" id="googleLogin">
                üåê Konekte ak Google
            </button>
            <button class="social-btn" id="facebookLogin">
                üìò Konekte ak Facebook
            </button>
        </div>

        <div class="register-link">
            Pa gen kont? <a href="Enskripsyon.html" >Kreye yon kont</a>
        </div>
    </div>

<script>
    console.log("Script ap k√≤manse...");

// Variables pou stock done yo
let currentUser = null;
let products = JSON.parse(localStorage.getItem('marketplaceProducts')) || [];
let sellers = JSON.parse(localStorage.getItem('marketplaceSellers')) || [];
let buyers = JSON.parse(localStorage.getItem('marketplaceBuyers')) || [];

// Fonksyon pou ouv√® modal achte
function openBuyModal() {
    console.log("Ouv√® modal achte");
    document.getElementById('buyModal').style.display = 'block';
}

// Fonksyon pou f√®men modal achte
function closeBuyModal() {
    console.log("F√®men modal achte");
    document.getElementById('buyModal').style.display = 'none';
}

// Fonksyon pou ouv√® modal vann
function openSellModal() {
    console.log("Ouv√® modal vann");
    document.getElementById('sellModal').style.display = 'block';
}

// Fonksyon pou f√®men modal vann
function closeSellModal() {
    console.log("F√®men modal vann");
    document.getElementById('sellModal').style.display = 'none';
}

// Fonksyon pou ouv√® modal ajoute pwodwi
function openAddProductModal() {
    console.log("Ouv√® modal ajoute pwodwi");
    document.getElementById('addProductModal').style.display = 'block';
}

// Fonksyon pou f√®men modal ajoute pwodwi
function closeAddProductModal() {
    console.log("F√®men modal ajoute pwodwi");
    document.getElementById('addProductModal').style.display = 'none';
}

// Fonksyon pou anrejistre itilizat√® ak localStorage
function registerUser(userData) {
    if (userData.userType === 'seller') {
        // Verifye si vand√® a deja egziste
        const existingSeller = sellers.find(seller => seller.email === userData.email);
        if (!existingSeller) {
            sellers.push(userData);
            localStorage.setItem('marketplaceSellers', JSON.stringify(sellers));
        }
    } else {
        // Verifye si acht√® a deja egziste
        const existingBuyer = buyers.find(buyer => buyer.email === userData.email);
        if (!existingBuyer) {
            buyers.push(userData);
            localStorage.setItem('marketplaceBuyers', JSON.stringify(buyers));
        }
    }
    
    // Sere itilizat√® kounye a nan localStorage
    localStorage.setItem('currentMarketplaceUser', JSON.stringify(userData));
    currentUser = userData;
}

// Fonksyon pou w voye nan Gran paj.html
function redirectToMainPage() {
    window.location.href = 'Gran paj.html';
}

// Modifye f√≤m enskripsyon prensipal la
document.getElementById('registrationForm').addEventListener('submit', function(e) {
    e.preventDefault();

    if (!selectedType) {
        alert('Tanpri chwazi si ou vle vann oswa achte!');
        return;
    }

    // Ramase done f√≤m nan
    const userData = {
        fullName: document.getElementById('fullName').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        location: document.getElementById('location').value,
        userType: selectedType,
        registrationDate: new Date().toISOString()
    };

    // Ajoute done espesifik selon tip itilizat√® a
    if (selectedType === 'seller') {
        userData.businessName = document.getElementById('businessName').value;
        userData.category = document.getElementById('category').value;
        userData.description = document.getElementById('description').value;
        userData.experience = document.getElementById('experience').value;
        userData.paid = false; // Default, ap chanje l√® peman f√®t
    } else {
        userData.interests = Array.from(document.getElementById('interests').selectedOptions).map(option => option.value);
        userData.budget = document.getElementById('budget').value;
    }

    // Anrejistre itilizat√® a
    registerUser(userData);

    // Redirije selon tip itilizat√® a
    if (selectedType === 'seller') {
        openSellModal(); // Ouv√® modal peman pou vand√®
    } else {
        // Pou acht√®, redirije imedyatman
        alert('üéâ Ou anrejistre ak siks√®! Ou ka kounye a komin√≤te achte.');
        redirectToMainPage();
    }

    // Reset f√≤m nan
    this.reset();
    selectedType = '';
    document.querySelectorAll('.type-option').forEach(option => {
        option.classList.remove('selected');
    });
    document.getElementById('sellerFields').classList.add('hidden');
    document.getElementById('buyerFields').classList.add('hidden');
});

// Fonksyon pou trete peman
function processPayment() {
    const paymentMethod = document.getElementById('paymentMethod').value;

    if (!paymentMethod) {
        alert('‚ö†Ô∏è Tanpri chwazi yon met√≤d peman');
        return;
    }

    console.log("Pwosesis peman ak:", paymentMethod);

    // Simile pwosesis peman
    alert('‚è≥ Pwosesis peman ak ' + paymentMethod + '...');

    setTimeout(() => {
        const verificationCode = 'VER' + Math.floor(Math.random() * 10000);
        console.log("K√≤d verifikasyon kreye:", verificationCode);

        const modalContent = document.querySelector('#sellModal .modal-content');
        modalContent.innerHTML = `
            <span class="close" onclick="closeSellModal()">&times;</span>
            <h2>‚úÖ Peman Reisi!</h2>
            <div class="verification-code">
                üîê K√≤d Verifikasyon ou: ${verificationCode}
            </div>
            <p>Kopi k√≤d la ak antre li pou konfime enskripsyon ou:</p>
            <div class="form-group">
                <input type="text" id="verificationInput" placeholder="Antre k√≤d verifikasyon">
            </div>
            <button class="submit-btn" onclick="verifyCode('${verificationCode}')">üîç Verifye</button>
        `;
    }, 2000);
}

// Fonksyon pou verifye k√≤d
function verifyCode(correctCode) {
    const inputCode = document.getElementById('verificationInput').value;

    if (inputCode === correctCode) {
        // Mete ajou vand√® a k√≤m verifye
        currentUser.paid = true;
        currentUser.verified = true;
        localStorage.setItem('currentMarketplaceUser', JSON.stringify(currentUser));
        
        // Mete ajou lis vand√® yo
        const sellerIndex = sellers.findIndex(seller => seller.email === currentUser.email);
        if (sellerIndex !== -1) {
            sellers[sellerIndex].paid = true;
            sellers[sellerIndex].verified = true;
            localStorage.setItem('marketplaceSellers', JSON.stringify(sellers));
        }

        closeSellModal();
        alert('üéâ Verifikasyon reisi! Ou ka kounye a komin√≤te vann sou platf√≤m nan.');
        redirectToMainPage();
    } else {
        alert('‚ùå K√≤d la pa k√≤r√®k. Tanpri eseye ank√≤.');
    }
}

// Fonksyon pou ajoute nouvo pwodwi
document.getElementById('addProductForm').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("Ajoute nouvo pwodwi");

    const productData = {
        id: Date.now(), // ID inik
        name: document.getElementById('productName').value,
        price: document.getElementById('productPrice').value,
        description: document.getElementById('productDescription').value,
        category: document.getElementById('productCategory').value,
        seller: currentUser.email,
        dateAdded: new Date().toISOString()
    };

    products.push(productData);
    
    // Sere nan localStorage
    localStorage.setItem('marketplaceProducts', JSON.stringify(products));
    console.log("Pwodwi ajoute:", productData);

    // Ajoute pwodwi nan afichaj
    updateProductDisplay();

    closeAddProductModal();
    alert('üéâ Pwodwi ajoute ak siks√®!');

    // Reset f√≤m nan
    this.reset();
});

// Fonksyon pou mete ajou afichaj pwodwi yo
function updateProductDisplay() {
    // Kod pou mete ajou lis pwodwi yo nan paj prensipal la
    console.log("Met ajou afichaj pwodwi yo");
}

// Fonksyon pou achte pwodwi
function buyProduct(productName, price) {
    console.log("Eseye achte:", productName, price);

    if (!currentUser || currentUser.userType !== 'buyer') {
        alert('‚ö†Ô∏è Ou dwe anrejistre k√≤m acht√® pou achte pwodwi yo');
        return;
    }

    if (confirm(`üõí Ou vr√®man vle achte ${productName} pou ${price}?`)) {
        alert(`üéâ Ou achte: ${productName} pou ${price}. M√®si pou acha ou!`);
    }
}

// Fonksyon pou retire pwodwi
function removeProduct(productId) {
    console.log("Retire pwodwi:", productId);

    if (confirm('‚ùì Ou vr√®man vle retire pwodwi sa a?')) {
        // Retire nan array products
        products = products.filter(p => p.id !== productId);
        
        // Mete ajou localStorage
        localStorage.setItem('marketplaceProducts', JSON.stringify(products));

        alert('‚úÖ Pwodwi retire ak siks√®!');
        updateProductDisplay();
    }
}

// Fonksyon pou chaje done depi localStorage l√® paj la chaje
function loadFromLocalStorage() {
    const savedUser = localStorage.getItem('currentMarketplaceUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        console.log("Itilizat√® chaje:", currentUser);
    }
    
    console.log("Pwodwi chaje:", products.length);
    console.log("Vand√® chaje:", sellers.length);
    console.log("Acht√® chaje:", buyers.length);
}

// F√®men modal yo l√® ou klike dey√≤
window.onclick = function(event) {
    const modals = document.getElementsByClassName('modal');
    for (let i = 0; i < modals.length; i++) {
        if (event.target === modals[i]) {
            modals[i].style.display = 'none';
        }
    }
}

// Chaje done l√® paj la fin chaje
window.addEventListener('load', function() {
    loadFromLocalStorage();
    console.log("‚úÖ Script marketplace la chaje ak siks√®!");
});

// Fonksyon pou tcheke si yon itilizat√® deja konekte
function checkExistingUser() {
    const existingUser = localStorage.getItem('currentMarketplaceUser');
    if (existingUser) {
        if (confirm('Gen yon itilizat√® ki deja konekte. Ou vle kontinye ak kont sa a?')) {
            redirectToMainPage();
        } else {
            // Dekonekte itilizat√® a si li pa vle kontinye
            localStorage.removeItem('currentMarketplaceUser');
        }
    }
}

// Tcheke itilizat√® konekte l√® paj la chaje
checkExistingUser();
</script>
</body>
</html>
